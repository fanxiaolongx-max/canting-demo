# 📊 投票限制功能说明

## 🎯 功能概述

为了保证投票的公平性和防止刷票，系统实现了基于设备的每日投票限制：
- **菜品投票**：每天最多 **3 票**（点赞）
- **厨师投票**：每天最多 **3 票**

---

## ✨ 核心特性

### 1. 每日限制
- ✅ 基于设备（localStorage）记录
- ✅ 每天自动重置投票额度
- ✅ 可以投给同一项多次（直到用完）
- ✅ 可以分散投给不同项

### 2. 智能提示
- ✅ 实时显示剩余票数
- ✅ 超限时友好提示
- ✅ 已投票项目标记
- ✅ 投票成功反馈

### 3. 视觉反馈
- ✅ 已投票的菜品：绿色背景 + ✅ 标记
- ✅ 已投票的厨师：禁用按钮显示"已投票"
- ✅ 标签页显示剩余票数
- ✅ 点赞按钮透明度变化

---

## 📱 使用方法

### 菜品投票

1. **访问投票页面**
   ```
   手机扫码 或 访问：
   http://your-ip:3010/mobile-vote.html
   ```

2. **查看剩余票数**
   - 顶部标签显示：`菜品投票 (剩余X票)`
   - 初始有 3 票

3. **为菜品投票**
   - 点击 👍 按钮投票
   - 成功后显示：`👍 点赞成功！今日还剩X票`
   - 已投票的菜品背景变绿，显示 ✅

4. **用完票数后**
   - 继续点击会提示：`⚠️ 今日菜品投票已达上限（每天3票）`
   - 明天自动重置

### 厨师投票

1. **切换到厨师标签**
   - 点击顶部"厨师投票"标签
   - 查看剩余票数：`厨师投票 (剩余X票)`

2. **为厨师投票**
   - 点击 👍 为TA投票 按钮
   - 成功后显示：`👍 投票成功！今日还剩X票`
   - 按钮变为灰色"✅ 已投票"

3. **用完票数后**
   - 继续点击会提示：`⚠️ 今日厨师投票已达上限（每天3票）`

---

## 🎮 投票策略

### 策略 1: 集中投票
```
3票全部投给最喜欢的菜品/厨师
✅ 优势：让喜欢的项目排名更高
```

### 策略 2: 分散投票
```
菜品A: 1票
菜品B: 1票  
菜品C: 1票
✅ 优势：支持多个喜欢的项目
```

### 策略 3: 混合策略
```
最爱菜品: 2票
其他菜品: 1票
✅ 优势：既突出重点，又照顾其他
```

---

## 🔧 技术实现

### 前端存储
```javascript
// 使用 localStorage 存储投票记录
{
    date: "2025-12-08",
    dishes: [101, 102, 103],  // 已投票的菜品ID
    chefs: [1, 2, 3]           // 已投票的厨师ID
}
```

### 投票流程
```
1. 用户点击投票
   ↓
2. 检查今日是否已投满3票
   ├─ 是 → 提示超限
   └─ 否 → 继续
       ↓
3. 发送投票请求到服务器
   ↓
4. 服务器更新数据库
   ↓
5. 返回最新数据
   ↓
6. 记录本次投票到 localStorage
   ↓
7. 更新UI显示
```

### 每日重置
```javascript
// 检查日期
const today = new Date().toDateString();
if (records.date !== today) {
    // 新的一天，重置投票记录
    records = { 
        date: today, 
        dishes: [], 
        chefs: [] 
    };
}
```

---

## 📊 API 接口

### 菜品投票
```javascript
POST /api/vote
Body: {
    dishId: 101,
    type: "up"  // "up" 或 "down"
}
```

### 厨师投票（新增）
```javascript
POST /api/vote-chef
Body: {
    chefId: 1
}
```

---

## 🎨 UI 示例

### 菜品投票页面
```
┌──────────────────────┐
│  菜品投票 (剩余2票)   │
├──────────────────────┤
│ ┌──────────────────┐ │
│ │ 小炒黄牛肉 ✅    │ │ ← 已投票（绿色背景）
│ │ 👨‍🍳 雷云龙       │ │
│ │ [👍 78] [👎 6]  │ │
│ └──────────────────┘ │
│ ┌──────────────────┐ │
│ │ 麻辣水煮鱼       │ │ ← 未投票
│ │ 👨‍🍳 彭刘锋       │ │
│ │ [👍 72] [👎 10] │ │
│ └──────────────────┘ │
└──────────────────────┘
```

### 厨师投票页面
```
┌──────────────────────┐
│  厨师投票 (剩余1票)   │
├──────────────────────┤
│ ┌──────────────────┐ │
│ │ [照片] 彭刘锋    │ │
│ │ 本周主厨         │ │
│ │ 擅长川味、鱼类   │ │
│ │ 日榜#1 月榜#1    │ │
│ │ [✅ 已投票]      │ │ ← 已投票
│ └──────────────────┘ │
│ ┌──────────────────┐ │
│ │ [照片] 兰达武    │ │
│ │ 本周主厨         │ │
│ │ 甜品、小吃高手   │ │
│ │ 日榜#2 月榜#2    │ │
│ │ [👍 为TA投票]    │ │ ← 可投票
│ └──────────────────┘ │
└──────────────────────┘
```

---

## 🔒 防刷机制

### 当前方案
- ✅ 基于设备 localStorage
- ✅ 每日自动重置
- ✅ 简单有效

### 优点
- ✅ 无需登录
- ✅ 用户友好
- ✅ 性能好

### 局限性
- ⚠️ 清除浏览器数据可重置
- ⚠️ 更换设备可重新投票
- ⚠️ 无法跨设备同步

### 未来增强（可选）
- 🔄 IP 地址限制
- 🔄 指纹识别
- 🔄 账号系统
- 🔄 验证码

---

## 📝 注意事项

### 用户须知
1. **票数限制**：每天3票，用完需等到明天
2. **设备绑定**：投票记录保存在当前设备
3. **清除数据**：清除浏览器数据会丢失投票记录
4. **公平投票**：请真实投票，支持你喜欢的菜品/厨师

### 管理员须知
1. **数据真实**：所有投票数据真实保存到数据库
2. **无法撤销**：用户投票后无法撤销（需管理员手动调整）
3. **后台查看**：可在后台管理查看投票数据
4. **数据备份**：系统自动备份，可恢复数据

---

## 🐛 常见问题

### Q: 为什么我还能继续投票？
**A**: 👎（踩）不受限制，只有 👍（点赞）受限。

### Q: 清除浏览器数据后能重新投票吗？
**A**: 可以，但请不要这样做，这违反了公平原则。

### Q: 更换手机后能重新投票吗？
**A**: 可以，不同设备有独立的投票额度。

### Q: 昨天的票没用完，会累积吗？
**A**: 不会，每天自动重置为3票。

### Q: 能否修改每日限制数量？
**A**: 可以，修改 `mobile-vote.html` 中的：
```javascript
const DAILY_LIMIT_DISHES = 3;  // 改为你想要的数量
const DAILY_LIMIT_CHEFS = 3;
```

### Q: 如何查看某用户的投票记录？
**A**: 当前基于设备，无法追踪个人。如需此功能，需添加账号系统。

---

## 🎉 总结

投票限制功能特点：
1. ✅ **公平性**：每个设备每天3票
2. ✅ **灵活性**：可投同一项或多项
3. ✅ **友好性**：清晰的提示和反馈
4. ✅ **简洁性**：无需登录，开箱即用

现在可以放心让用户投票了！📊✨

