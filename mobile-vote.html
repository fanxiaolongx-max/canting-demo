<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äººæ°”æŠ•ç¥¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, "Microsoft YaHei", sans-serif; }
        body { 
            background: linear-gradient(135deg, #0f6b48 0%, #1a8d5f 100%); 
            min-height: 100vh; 
            padding: 20px;
            padding-bottom: 40px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .header {
            text-align: center;
            color: white;
            padding: 20px 0 30px;
        }
        .header h1 { font-size: 28px; margin-bottom: 8px; }
        .header p { font-size: 14px; opacity: 0.9; }

        .tab-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab {
            flex: 1;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s;
        }
        .tab.active {
            background: white;
            color: #0f6b48;
            font-weight: bold;
        }

        .vote-container {
            display: none;
        }
        .vote-container.active {
            display: block;
        }

        .dish-card, .chef-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .dish-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .dish-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        .dish-chef {
            font-size: 14px;
            color: #666;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .rank-badge {
            background: #ffd700;
            color: #333;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        .rank-badge.top3 { background: linear-gradient(135deg, #ffd700, #ffed4e); }

        .vote-buttons {
            display: flex;
            gap: 10px;
        }
        .vote-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .vote-btn.up {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }
        .vote-btn.up:active {
            background: #4caf50;
            color: white;
            transform: scale(0.95);
        }
        .vote-btn.down {
            background: #fce4ec;
            color: #c2185b;
            border: 2px solid #e91e63;
        }
        .vote-btn.down:active {
            background: #e91e63;
            color: white;
            transform: scale(0.95);
        }

        /* å·²æŠ•ç¥¨çŠ¶æ€ */
        .vote-btn.voted {
            background: #ff9800 !important;
            color: white !important;
            border-color: #ff9800 !important;
        }
        .vote-btn.voted:hover {
            background: #f57c00 !important;
        }
        .vote-btn.voted:active {
            background: #e65100 !important;
            transform: scale(0.95);
        }

        .vote-count {
            font-weight: bold;
            font-size: 18px;
        }

        .chef-card {
            display: flex;
            gap: 15px;
        }
        .chef-photo {
            width: 80px;
            height: 90px;
            object-fit: cover;
            border-radius: 8px;
            background: #eee;
        }
        .chef-info {
            flex: 1;
        }
        .chef-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .chef-role {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }
        .chef-desc {
            font-size: 12px;
            color: #999;
            line-height: 1.4;
        }
        .chef-rank {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            font-size: 12px;
        }
        .rank-item {
            background: #f5f5f5;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            z-index: 1000;
            display: none;
        }

        .loading {
            text-align: center;
            color: white;
            padding: 40px;
            font-size: 16px;
        }

        .empty {
            text-align: center;
            color: white;
            padding: 60px 20px;
        }
        .empty-icon { font-size: 48px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ½ï¸ é¤å…äººæ°”æŠ•ç¥¨</h1>
        <p>ä¸ºä½ å–œæ¬¢çš„èœå“å’Œå¨å¸ˆæŠ•ç¥¨å§ï¼</p>
    </div>

    <div class="tab-bar">
        <button class="tab active" onclick="switchTab('dishes')">èœå“æŠ•ç¥¨</button>
        <button class="tab" onclick="switchTab('chefs')">å¨å¸ˆæŠ•ç¥¨</button>
    </div>

    <div id="dishes-container" class="vote-container active">
        <div class="loading">åŠ è½½ä¸­...</div>
    </div>

    <div id="chefs-container" class="vote-container">
        <div class="loading">åŠ è½½ä¸­...</div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        let currentData = null;
        let currentTab = 'dishes';

        // æŠ•ç¥¨é™åˆ¶ç®¡ç†
        const DAILY_LIMIT_DISHES = 3;
        const DAILY_LIMIT_CHEFS = 3;

        // è·å–ä»Šå¤©çš„æŠ•ç¥¨è®°å½•
        function getTodayVotes() {
            const today = new Date().toDateString();
            const stored = localStorage.getItem('vote_records');
            if (!stored) {
                return { 
                    date: today, 
                    dishUpCount: 0, 
                    dishDownCount: 0,
                    chefCount: 0, 
                    votedDishesUp: [], 
                    votedDishesDown: [],
                    votedChefs: [],
                    cancelDishUpCount: 0,
                    cancelDishDownCount: 0,
                    cancelChefCount: 0
                };
            }
            
            const records = JSON.parse(stored);
            // å¦‚æœæ˜¯æ–°çš„ä¸€å¤©ï¼Œé‡ç½®æŠ•ç¥¨è®°å½•
            if (records.date !== today) {
                return { 
                    date: today, 
                    dishUpCount: 0, 
                    dishDownCount: 0,
                    chefCount: 0, 
                    votedDishesUp: [], 
                    votedDishesDown: [],
                    votedChefs: [],
                    cancelDishUpCount: 0,
                    cancelDishDownCount: 0,
                    cancelChefCount: 0
                };
            }
            // å…¼å®¹æ—§æ ¼å¼
            if (!records.dishUpCount) {
                records.dishUpCount = records.dishCount || 0;
                records.dishDownCount = 0;
                records.votedDishesUp = records.votedDishes || [];
                records.votedDishesDown = [];
            }
            // åˆå§‹åŒ–å–æ¶ˆæŠ•ç¥¨è®¡æ•°
            if (records.cancelDishUpCount === undefined) {
                records.cancelDishUpCount = 0;
                records.cancelDishDownCount = 0;
                records.cancelChefCount = 0;
            }
            return records;
        }

        // ä¿å­˜æŠ•ç¥¨è®°å½•ï¼ˆåŒºåˆ†ç‚¹èµå’Œè¸©ï¼‰
        function saveVoteRecord(type, itemId) {
            const records = getTodayVotes();
            if (type === 'dish-up') {
                records.dishUpCount = (records.dishUpCount || 0) + 1;
                if (!records.votedDishesUp) records.votedDishesUp = [];
                if (!records.votedDishesUp.includes(itemId)) {
                    records.votedDishesUp.push(itemId);
                }
            } else if (type === 'dish-down') {
                records.dishDownCount = (records.dishDownCount || 0) + 1;
                if (!records.votedDishesDown) records.votedDishesDown = [];
                if (!records.votedDishesDown.includes(itemId)) {
                    records.votedDishesDown.push(itemId);
                }
            } else if (type === 'chef') {
                records.chefCount = (records.chefCount || 0) + 1;
                if (!records.votedChefs) records.votedChefs = [];
                if (!records.votedChefs.includes(itemId)) {
                    records.votedChefs.push(itemId);
                }
            }
            localStorage.setItem('vote_records', JSON.stringify(records));
        }

        // ä¿å­˜å–æ¶ˆæŠ•ç¥¨è®°å½•ï¼ˆå–æ¶ˆåå¯ä»¥é‡æ–°æŠ•ç¥¨ï¼‰
        function saveCancelRecord(type, itemId) {
            const records = getTodayVotes();
            if (type === 'dish-up') {
                records.cancelDishUpCount = (records.cancelDishUpCount || 0) + 1;
                // ä»æŠ•ç¥¨åˆ—è¡¨ä¸­ç§»é™¤ï¼Œå…è®¸é‡æ–°æŠ•ç¥¨
                if (records.votedDishesUp) {
                    records.votedDishesUp = records.votedDishesUp.filter(id => id !== itemId);
                }
                // å‡å°‘æŠ•ç¥¨è®¡æ•°
                records.dishUpCount = Math.max(0, (records.dishUpCount || 0) - 1);
            } else if (type === 'dish-down') {
                records.cancelDishDownCount = (records.cancelDishDownCount || 0) + 1;
                if (records.votedDishesDown) {
                    records.votedDishesDown = records.votedDishesDown.filter(id => id !== itemId);
                }
                records.dishDownCount = Math.max(0, (records.dishDownCount || 0) - 1);
            } else if (type === 'chef') {
                records.cancelChefCount = (records.cancelChefCount || 0) + 1;
                if (records.votedChefs) {
                    records.votedChefs = records.votedChefs.filter(id => id !== itemId);
                }
                records.chefCount = Math.max(0, (records.chefCount || 0) - 1);
            }
            localStorage.setItem('vote_records', JSON.stringify(records));
        }

        // æ£€æŸ¥æ˜¯å¦å¯ä»¥å–æ¶ˆæŠ•ç¥¨ï¼ˆæ¯å¤©æœ€å¤š3æ¬¡ï¼‰
        function canCancel(type) {
            const records = getTodayVotes();
            if (type === 'dish-up') {
                return (records.cancelDishUpCount || 0) < 3;
            } else if (type === 'dish-down') {
                return (records.cancelDishDownCount || 0) < 3;
            } else if (type === 'chef') {
                return (records.cancelChefCount || 0) < 3;
            }
            return false;
        }

        // æ£€æŸ¥æ˜¯å¦å¯ä»¥æŠ•ç¥¨ï¼ˆåŸºäºè®¡æ•°ï¼‰
        function canVote(type) {
            const records = getTodayVotes();
            if (type === 'dish-up') {
                return (records.dishUpCount || 0) < DAILY_LIMIT_DISHES;
            } else if (type === 'dish-down') {
                return (records.dishDownCount || 0) < DAILY_LIMIT_DISHES;
            } else if (type === 'chef') {
                return (records.chefCount || 0) < DAILY_LIMIT_CHEFS;
            }
            return false;
        }

        // è·å–å‰©ä½™æŠ•ç¥¨æ•°ï¼ˆåŸºäºè®¡æ•°ï¼‰
        function getRemainingVotes(type) {
            const records = getTodayVotes();
            if (type === 'dish-up') {
                return DAILY_LIMIT_DISHES - (records.dishUpCount || 0);
            } else if (type === 'dish-down') {
                return DAILY_LIMIT_DISHES - (records.dishDownCount || 0);
            } else if (type === 'chef') {
                return DAILY_LIMIT_CHEFS - (records.chefCount || 0);
            }
            return 0;
        }

        // åŠ è½½æ•°æ®
        function loadData() {
            fetch('/api/data')
                .then(res => res.json())
                .then(data => {
                    currentData = data;
                    renderDishes();
                    renderChefs();
                    updateVoteStatus();
                })
                .catch(err => {
                    showToast('åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•');
                    console.error(err);
                });
        }

        // æ›´æ–°æŠ•ç¥¨çŠ¶æ€æ˜¾ç¤º
        function updateVoteStatus() {
            const dishUpRemaining = getRemainingVotes('dish-up');
            const dishDownRemaining = getRemainingVotes('dish-down');
            const chefRemaining = getRemainingVotes('chef');
            
            // å¯ä»¥åœ¨æ ‡é¢˜å¤„æ˜¾ç¤ºå‰©ä½™ç¥¨æ•°
            const dishesHeader = document.querySelector('.tab-bar .tab:first-child');
            const chefsHeader = document.querySelector('.tab-bar .tab:last-child');
            
            if (dishesHeader) {
                dishesHeader.innerHTML = `èœå“æŠ•ç¥¨ <span style="font-size:11px;opacity:0.8">(ğŸ‘${dishUpRemaining} ğŸ‘${dishDownRemaining})</span>`;
            }
            if (chefsHeader) {
                chefsHeader.innerHTML = `å¨å¸ˆæŠ•ç¥¨ <span style="font-size:11px;opacity:0.8">(å‰©ä½™${chefRemaining}ç¥¨)</span>`;
            }
        }

        // æ¸²æŸ“èœå“
        function renderDishes() {
            const container = document.getElementById('dishes-container');
            const dishes = currentData.dishes || [];
            
            if (dishes.length === 0) {
                container.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ“­</div><p>æš‚æ— èœå“</p></div>';
                return;
            }

            // æ£€æŸ¥å“ªäº›èœå“å·²æŠ•ç¥¨
            const records = getTodayVotes();

            container.innerHTML = dishes.map((dish, index) => {
                const hasVotedUp = records.votedDishesUp && records.votedDishesUp.includes(dish.id);
                const hasVotedDown = records.votedDishesDown && records.votedDishesDown.includes(dish.id);
                const hasAnyVote = hasVotedUp || hasVotedDown;
                const canCancelUp = hasVotedUp && canCancel('dish-up');
                const canCancelDown = hasVotedDown && canCancel('dish-down');
                
                return `
                    <div class="dish-card" style="${hasAnyVote ? 'background: #f0f9f0; border: 2px solid #4caf50;' : ''}">
                        <div class="dish-header">
                            <div>
                                <div class="dish-name">${dish.name} ${hasVotedUp ? 'âœ…ğŸ‘' : ''}${hasVotedDown ? 'âœ…ğŸ‘' : ''}</div>
                                <div class="dish-chef">ğŸ‘¨â€ğŸ³ ${dish.chef}</div>
                            </div>
                            <div class="rank-badge ${index < 3 ? 'top3' : ''}">${index + 1}</div>
                        </div>
                        <div class="vote-buttons">
                            <button class="vote-btn up ${hasVotedUp ? 'voted' : ''}" onclick="vote(${dish.id}, 'up')" ${hasVotedUp && !canCancelUp ? 'style="opacity: 0.5; cursor: not-allowed;" title="ä»Šæ—¥å–æ¶ˆæ¬¡æ•°å·²ç”¨å®Œ"' : ''}>
                                ${hasVotedUp ? 'â†©ï¸' : 'ğŸ‘'} <span class="vote-count">${dish.up}</span>
                            </button>
                            <button class="vote-btn down ${hasVotedDown ? 'voted' : ''}" onclick="vote(${dish.id}, 'down')" ${hasVotedDown && !canCancelDown ? 'style="opacity: 0.5; cursor: not-allowed;" title="ä»Šæ—¥å–æ¶ˆæ¬¡æ•°å·²ç”¨å®Œ"' : ''}>
                                ${hasVotedDown ? 'â†©ï¸' : 'ğŸ‘'} <span class="vote-count">${dish.down}</span>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ¸²æŸ“å¨å¸ˆ
        function renderChefs() {
            const container = document.getElementById('chefs-container');
            const chefs = [...(currentData.chefs || [])].sort((a,b) => a.daily_rank - b.daily_rank);
            
            if (chefs.length === 0) {
                container.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ‘¨â€ğŸ³</div><p>æš‚æ— å¨å¸ˆ</p></div>';
                return;
            }

            // æ£€æŸ¥å“ªäº›å¨å¸ˆå·²æŠ•ç¥¨
            const records = getTodayVotes();

            container.innerHTML = chefs.map(chef => {
                const hasVoted = records.votedChefs && records.votedChefs.includes(chef.id);
                const canCancelChef = hasVoted && canCancel('chef');
                return `
                    <div class="chef-card" style="position: relative;">
                        <img src="${chef.photo}" class="chef-photo" onerror="this.src='static/logo.png'">
                        <div class="chef-info">
                            <div class="chef-name">${chef.name}</div>
                            <div class="chef-role">${chef.role}</div>
                            <div class="chef-desc">${chef.desc}</div>
                            <div class="chef-rank">
                                <span class="rank-item">æ—¥æ¦œ #${chef.daily_rank}</span>
                                <span class="rank-item">æœˆæ¦œ #${chef.monthly_rank}</span>
                                <span class="rank-item">æœˆç¥¨ ${chef.monthly_votes}</span>
                            </div>
                            <button class="vote-btn up ${hasVoted ? 'voted' : ''}" style="margin-top: 10px; width: 100%;" onclick="voteChef(${chef.id})" ${hasVoted && !canCancelChef ? 'style="background: #ccc; cursor: not-allowed; margin-top: 10px; width: 100%;" title="ä»Šæ—¥å–æ¶ˆæ¬¡æ•°å·²ç”¨å®Œ"' : ''}>
                                ${hasVoted ? 'â†©ï¸ å–æ¶ˆæŠ•ç¥¨' : 'ğŸ‘ ä¸ºTAæŠ•ç¥¨'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åˆ‡æ¢æ ‡ç­¾
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.vote-container').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + '-container').classList.add('active');
        }

        // èœå“æŠ•ç¥¨ï¼ˆæ”¯æŒå–æ¶ˆï¼‰
        function vote(dishId, type) {
            const records = getTodayVotes();
            const hasVotedUp = records.votedDishesUp && records.votedDishesUp.includes(dishId);
            const hasVotedDown = records.votedDishesDown && records.votedDishesDown.includes(dishId);
            
            // åˆ¤æ–­æ˜¯æŠ•ç¥¨è¿˜æ˜¯å–æ¶ˆ
            const isVoting = (type === 'up' && !hasVotedUp) || (type === 'down' && !hasVotedDown);
            
            if (isVoting) {
                // æ‰§è¡ŒæŠ•ç¥¨
                // æ£€æŸ¥æŠ•ç¥¨é™åˆ¶
                if (type === 'up') {
                    if (!canVote('dish-up')) {
                        showToast(`âš ï¸ ä»Šæ—¥ç‚¹èµå·²è¾¾ä¸Šé™ï¼ˆæ¯å¤©${DAILY_LIMIT_DISHES}ç¥¨ï¼‰`);
                        return;
                    }
                } else if (type === 'down') {
                    if (!canVote('dish-down')) {
                        showToast(`âš ï¸ ä»Šæ—¥è¸©å·²è¾¾ä¸Šé™ï¼ˆæ¯å¤©${DAILY_LIMIT_DISHES}ç¥¨ï¼‰`);
                        return;
                    }
                }

                fetch('/api/vote', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ dishId, type })
                })
                .then(res => res.json())
                .then(res => {
                    if (res.success) {
                        currentData = res.newData;
                        
                        // è®°å½•æŠ•ç¥¨
                        if (type === 'up') {
                            saveVoteRecord('dish-up', dishId);
                        } else if (type === 'down') {
                            saveVoteRecord('dish-down', dishId);
                        }
                        
                        // é‡æ–°æ¸²æŸ“
                        renderDishes();
                        updateVoteStatus();
                        
                        // æ˜¾ç¤ºæç¤º
                        if (type === 'up') {
                            const remaining = getRemainingVotes('dish-up');
                            showToast(`ğŸ‘ ç‚¹èµæˆåŠŸï¼ä»Šæ—¥è¿˜å‰©${remaining}ç¥¨`);
                        } else {
                            const remaining = getRemainingVotes('dish-down');
                            showToast(`ğŸ‘ å·²è®°å½•ï¼ä»Šæ—¥è¿˜å‰©${remaining}ç¥¨`);
                        }
                    } else {
                        showToast('æŠ•ç¥¨å¤±è´¥');
                    }
                })
                .catch(err => {
                    showToast('ç½‘ç»œé”™è¯¯');
                    console.error(err);
                });
            } else {
                // æ‰§è¡Œå–æ¶ˆæŠ•ç¥¨
                if (type === 'up' && !hasVotedUp) return;
                if (type === 'down' && !hasVotedDown) return;
                
                // æ£€æŸ¥å–æ¶ˆé™åˆ¶
                if (!canCancel(`dish-${type}`)) {
                    showToast(`âš ï¸ ä»Šæ—¥å–æ¶ˆæŠ•ç¥¨å·²è¾¾ä¸Šé™ï¼ˆæ¯å¤©3æ¬¡ï¼‰`);
                    return;
                }

                fetch('/api/vote-cancel', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ dishId, type })
                })
                .then(res => res.json())
                .then(res => {
                    if (res.success) {
                        currentData = res.newData;
                        
                        // è®°å½•å–æ¶ˆæŠ•ç¥¨
                        saveCancelRecord(`dish-${type}`, dishId);
                        
                        // é‡æ–°æ¸²æŸ“
                        renderDishes();
                        updateVoteStatus();
                        
                        showToast(`â†©ï¸ å·²å–æ¶ˆ${type === 'up' ? 'ç‚¹èµ' : 'è¸©'}`);
                    } else {
                        showToast('å–æ¶ˆå¤±è´¥');
                    }
                })
                .catch(err => {
                    showToast('ç½‘ç»œé”™è¯¯');
                    console.error(err);
                });
            }
        }

        // å¨å¸ˆæŠ•ç¥¨ï¼ˆæ”¯æŒå–æ¶ˆï¼‰
        function voteChef(chefId) {
            const records = getTodayVotes();
            const hasVoted = records.votedChefs && records.votedChefs.includes(chefId);
            
            if (!hasVoted) {
                // æ‰§è¡ŒæŠ•ç¥¨
                // æ£€æŸ¥æŠ•ç¥¨é™åˆ¶
                if (!canVote('chef')) {
                    showToast(`âš ï¸ ä»Šæ—¥å¨å¸ˆæŠ•ç¥¨å·²è¾¾ä¸Šé™ï¼ˆæ¯å¤©${DAILY_LIMIT_CHEFS}ç¥¨ï¼‰`);
                    return;
                }

                fetch('/api/vote-chef', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chefId })
                })
                .then(res => res.json())
                .then(res => {
                    if (res.success) {
                        currentData = res.newData;
                        
                        // è®°å½•æŠ•ç¥¨
                        saveVoteRecord('chef', chefId);
                        
                        // é‡æ–°æ¸²æŸ“
                        renderChefs();
                        updateVoteStatus();
                        const remaining = getRemainingVotes('chef');
                        showToast(`ğŸ‘ æŠ•ç¥¨æˆåŠŸï¼ä»Šæ—¥è¿˜å‰©${remaining}ç¥¨`);
                    } else {
                        showToast('æŠ•ç¥¨å¤±è´¥');
                    }
                })
                .catch(err => {
                    showToast('ç½‘ç»œé”™è¯¯');
                    console.error(err);
                });
            } else {
                // æ‰§è¡Œå–æ¶ˆæŠ•ç¥¨
                // æ£€æŸ¥å–æ¶ˆé™åˆ¶
                if (!canCancel('chef')) {
                    showToast(`âš ï¸ ä»Šæ—¥å–æ¶ˆæŠ•ç¥¨å·²è¾¾ä¸Šé™ï¼ˆæ¯å¤©3æ¬¡ï¼‰`);
                    return;
                }

                fetch('/api/vote-chef-cancel', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chefId })
                })
                .then(res => res.json())
                .then(res => {
                    if (res.success) {
                        currentData = res.newData;
                        
                        // è®°å½•å–æ¶ˆæŠ•ç¥¨
                        saveCancelRecord('chef', chefId);
                        
                        // é‡æ–°æ¸²æŸ“
                        renderChefs();
                        updateVoteStatus();
                        showToast('â†©ï¸ å·²å–æ¶ˆæŠ•ç¥¨');
                    } else {
                        showToast('å–æ¶ˆå¤±è´¥');
                    }
                })
                .catch(err => {
                    showToast('ç½‘ç»œé”™è¯¯');
                    console.error(err);
                });
            }
        }


        // æ˜¾ç¤ºæç¤º
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.innerText = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 2000);
        }

        // é¡µé¢åŠ è½½
        loadData();
    </script>
</body>
</html>


