<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¤å…çœ‹æ¿</title>
    <style>
        /* --- å…¨å±€æ ·å¼ --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Microsoft YaHei", sans-serif; }
        body { background-color: #f0f2f5; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; }

        /* ä¸»å¤§å±å®¹å™¨ */
        .dashboard-container {
            width: 95%; height: 90%;
            background-color: #fff;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex; flex-direction: column;
            border-radius: 8px; overflow: hidden;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        header { background-color: #0f6b48; color: rgba(255,255,255,0.8); padding: 10px 20px; font-size: 12px; display: flex; gap: 20px; flex-shrink: 0; }
        .header-title-area { background-color: #0f6b48; color: #fff; padding: 10px 30px; font-size: 24px; font-weight: bold; flex-shrink: 0; }

        /* ä¸»å†…å®¹åŒºå¸ƒå±€ */
        .main-content { flex: 1; display: flex; padding: 20px 30px; gap: 30px; position: relative; overflow: hidden; }
        .section-title { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 15px; flex-shrink: 0; }

        /* --- å·¦ä¾§ï¼šèœå“æ¦œ --- */
        .column-left { flex: 0 0 40%; display: flex; flex-direction: column; border-right: 1px solid #e0e0e0; padding-right: 20px; height: 100%; }
        /* åˆ—è¡¨æ»šåŠ¨åŒº */
        .dish-list { overflow-y: auto; flex: 1; padding-right: 10px; }
        .dish-list::-webkit-scrollbar { width: 6px; }
        .dish-list::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }

        .dish-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #f5f5f5; }
        .rank-badge { width: 24px; height: 24px; background-color: #999; color: #fff; text-align: center; line-height: 24px; font-size: 14px; margin-right: 15px; border-radius: 2px; }
        .rank-badge.top-3 { background-color: #0f6b48; }
        .dish-info { flex: 1; font-size: 15px; color: #333; }
        .dish-info span { color: #666; font-size: 13px; }

        .vote-stats { display: flex; gap: 15px; color: #666; font-size: 14px; }
        .icon-group { display: flex; gap: 4px; cursor: pointer; align-items: center; }
        .icon-group:hover svg { fill: #0f6b48; }
        svg { width: 16px; height: 16px; fill: #999; transition: 0.2s; }

        /* --- ä¸­é—´ï¼šæ—¥æ¦œ --- */
        .column-middle { flex: 0 0 30%; display: flex; flex-direction: column; position: relative; height: 100%; }
        .chef-list-wrapper { flex: 1; overflow-y: auto; } /* ä¸­é—´ä¹Ÿè®©åˆ—è¡¨å•ç‹¬æ»šåŠ¨ */

        .chef-list-item { display: flex; margin-bottom: 25px; }
        .chef-rank { font-size: 16px; color: #666; margin-right: 15px; padding-top: 10px; }
        .chef-photo { width: 60px; height: 70px; background-color: #eee; margin-right: 15px; object-fit: cover; border-radius: 4px; }
        .chef-details h4 { font-size: 16px; margin-bottom: 5px; color: #333; }
        .chef-details p { font-size: 12px; color: #666; line-height: 1.4; }

        .footer-location { margin-top: auto; padding-top: 10px; font-size: 12px; color: #666; display: flex; gap: 5px; }

        /* --- å³ä¾§ï¼šå…³é”®ä¿®å¤åŒºåŸŸ --- */
        .column-right {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            height: 100%;
            overflow: hidden; /* ç¦æ­¢å³ä¾§æ•´ä½“æ»šåŠ¨ï¼Œé˜²æ­¢æ’‘ç ´å¸ƒå±€ */
        }

        /* 1. åˆ—è¡¨åŒºåŸŸï¼šå æ®å‰©ä½™ç©ºé—´ï¼Œç‹¬ç«‹æ»šåŠ¨ */
        #chef-monthly-container {
            flex: 1;
            overflow-y: auto;
            min-height: 0; /* Firefox/Flex bug fix */
            padding-bottom: 10px;
        }
        #chef-monthly-container::-webkit-scrollbar { width: 0; } /* éšè—æ»šåŠ¨æ¡ç¾è§‚ */

        .month-rank-item { display: flex; align-items: center; margin-bottom: 20px; }
        .medal { width: 20px; margin-right: 10px; text-align: center; font-size: 18px; }
        .chef-mini-photo { width: 40px; height: 40px; background-color: #eee; border-radius: 50%; margin-right: 10px; object-fit: cover; }
        .month-details strong { font-size: 14px; display:block; }
        .month-details span { font-size: 12px; color: #999; }
        .month-score { margin-left: auto; font-size: 12px; color: #666; }

        /* 2. å¡ç‰‡åŒºåŸŸï¼šå›ºå®šåº•éƒ¨ï¼Œä¸éšåˆ—è¡¨æ»šåŠ¨ */
        .profile-card {
            flex-shrink: 0; /* ç¦æ­¢è¢«å‹ç¼© */
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
            margin-top: 10px;

            /* å…³é”®ï¼šåº•éƒ¨ç•™ç™½ç»™ Logoï¼Œé¿å…é‡å  */
            margin-bottom: 60px;
            position: relative;
            z-index: 10;
        }

        .profile-header { display: flex; gap: 10px; margin-bottom: 10px; }
        .qr-section { display: flex; gap: 10px; }
        .qr-box { flex: 1; background: #fff; padding: 5px; display: flex; align-items: center; gap: 5px; border: 1px solid #eee; }
        .qr-img { width: 30px; height: 30px; object-fit: contain; }

        /* 3. Logo åŒºåŸŸï¼šç»å¯¹å®šä½åœ¨å³ä¸‹è§’ */
        .huawei-logo {
            position: absolute;
            bottom: 0;
            right: 0;
            display: flex;
            align-items: center;
            z-index: 999; /* ç¡®ä¿æœ€ä¸Šå±‚ */
            background: #fff; /* é˜²æ­¢èƒŒæ™¯é€æ˜æ–‡å­—é‡å  */
            padding: 5px;
        }
        .logo-img { height: 50px; width: auto; }

    </style>
</head>
<body>

    <div class="dashboard-container">
        <header>
            <span>Home</span><span>Administration</span><span>IT</span><span>HR</span>
            <span>Transaction flow</span><span>Privacy Statement</span>
        </header>

        <div class="header-title-area" id="page-title">åŠ è½½ä¸­...</div>

        <div class="main-content">
            <div class="column-left">
                <div class="section-title">äººæ°”èœå“æ¦œ</div>
                <div class="dish-list" id="dish-container"></div>
            </div>

            <div class="column-middle">
                <div class="section-title">äººæ°”å¨å¸ˆæ—¥æ¦œ</div>
                <div class="chef-list-wrapper" id="chef-daily-container">
                    </div>
                <div class="footer-location" id="date-location">
                    ğŸ“ --
                </div>
            </div>

            <div class="column-right">
                <div class="section-title">äººæ°”å¨å¸ˆæœˆæ¦œ</div>

                <div id="chef-monthly-container">
                    </div>

                <div class="profile-card" id="profile-card" style="display:none;">
                    </div>

                <div class="huawei-logo">
                    <img id="footer-logo" src="" class="logo-img">
                </div>
            </div>
        </div>
    </div>

    <script>
        // é¡µé¢å¯åŠ¨æ—¶è·å–æ•°æ®
        fetch('/api/data')
            .then(res => res.json())
            .then(data => renderPage(data))
            .catch(err => {
                console.error("Fetch error:", err);
                document.getElementById('page-title').innerText = "æ— æ³•è¿æ¥æ•°æ®æœåŠ¡";
            });

        function renderPage(data) {
            const config = data.config || {};
            const dishes = data.dishes || [];
            const chefs = data.chefs || [];

            // 1. é…ç½®åŸºç¡€ä¿¡æ¯
            document.getElementById('page-title').innerText = config.title || "é¤å…çœ‹æ¿";
            document.getElementById('date-location').innerText = `ğŸ“ ${config.date || ''}`;

            // å¤„ç† Logo å›¾ç‰‡ (å³ä½¿æ²¡æ•°æ®ä¹Ÿæ˜¾ç¤ºä¸ªé»˜è®¤å ä½ï¼Œé˜²æ­¢å½»åº•æ¶ˆå¤±)
            const logoImg = document.getElementById('footer-logo');
            logoImg.src = config.logo_url || 'static/logo.png';
            logoImg.onerror = function() { this.style.display = 'none'; }; // å›¾ç‰‡åäº†å°±éšè—

            // 2. æ¸²æŸ“èœå“åˆ—è¡¨
            const dishHtml = dishes.map((dish, index) => {
                const rank = index + 1;
                return `
                    <div class="dish-item">
                        <div class="rank-badge ${rank <= 3 ? 'top-3' : ''}">${rank}</div>
                        <div class="dish-info">${dish.name} - <span>${dish.chef}</span></div>
                        <div class="vote-stats">
                            <div class="icon-group" onclick="vote(${dish.id}, 'up')">
                                <svg viewBox="0 0 24 24"><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-1.91l-.01-.01L23 10z"/></svg>
                                <span>${dish.up}</span>
                            </div>
                            <div class="icon-group" onclick="vote(${dish.id}, 'down')">
                                <svg viewBox="0 0 24 24" style="transform: rotate(180deg);"><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-1.91l-.01-.01L23 10z"/></svg>
                                <span>${dish.down}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            document.getElementById('dish-container').innerHTML = dishHtml;

            // 3. æ¸²æŸ“å¨å¸ˆåˆ—è¡¨ (æ—¥æ¦œ)
            const dailyChefs = [...chefs].sort((a,b) => a.daily_rank - b.daily_rank);
            document.getElementById('chef-daily-container').innerHTML = dailyChefs.map(chef => `
                <div class="chef-list-item">
                    <div class="chef-rank">${chef.daily_rank}</div>
                    <img src="${chef.photo}" class="chef-photo" onerror="this.src='//via.placeholder.com/60'">
                    <div class="chef-details">
                        <h4>${chef.name}</h4>
                        <p>${chef.desc}</p>
                    </div>
                </div>
            `).join('');

            // 4. æ¸²æŸ“æœˆæ¦œ
            const monthlyChefs = [...chefs].sort((a,b) => a.monthly_rank - b.monthly_rank);
            document.getElementById('chef-monthly-container').innerHTML = monthlyChefs.map(chef => `
                <div class="month-rank-item">
                    <div class="medal">${chef.monthly_rank === 1 ? 'ğŸ¥‡' : 'ğŸ¥ˆ'}</div>
                    <img src="${chef.photo}" class="chef-mini-photo">
                    <div class="month-details">
                        <strong>${chef.name}</strong>
                        <span>æœ¬æœˆå¾—ç¥¨: ${chef.monthly_votes}</span>
                    </div>
                    <div class="month-score">æœˆåº¦ç¬¬${chef.monthly_rank}å</div>
                </div>
            `).join('');

            // 5. æ¸²æŸ“ä¸ªäººå¡ç‰‡ (åªè¦æœ‰å¨å¸ˆæ•°æ®å°±æ˜¾ç¤º)
            const topChef = dailyChefs.length > 0 ? dailyChefs[0] : null;
            const card = document.getElementById('profile-card');

            if (topChef) {
                card.style.display = "block"; // æ˜¾ç¤ºå¡ç‰‡
                card.innerHTML = `
                    <div class="profile-header">
                        <img src="${topChef.photo}" class="chef-photo" onerror="this.src='//via.placeholder.com/60'">
                        <div class="chef-details">
                            <h4>${topChef.name} <span>${topChef.role}</span></h4>
                            <p>${topChef.desc}</p>
                        </div>
                    </div>
                    <div class="qr-section">
                        <div class="qr-box"><img src="${config.qr_url}" class="qr-img"><span style="font-size:10px;color:#666">å¿ƒå£°å¢™</span></div>
                        <div class="qr-box"><img src="${config.qr_url}" class="qr-img"><span style="font-size:10px;color:#666">ç‚¹èµæ¦œ</span></div>
                    </div>
                `;
            } else {
                card.style.display = "none";
            }
        }

        // æŠ•ç¥¨åŠŸèƒ½
        function vote(id, type) {
            fetch('/api/vote', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ dishId: id, type: type })
            })
            .then(res => res.json())
            .then(res => {
                if(res.success) {
                    renderPage(res.newData);
                }
            });
        }
    </script>
</body>
</html>
