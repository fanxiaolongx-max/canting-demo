# 🍽️ 餐厅看板系统 v3.0

一个现代化的餐厅数据展示与管理系统，支持菜品点赞、厨师排行、手机投票、匿名论坛等功能。

## 🆕 v3.0 重大更新

- ✅ **SQLite 数据库**：从 JSON 文件迁移到 SQLite，更快更可靠
- ✅ **表格化管理**：全新管理界面，支持批量操作
- ✅ **放大二维码**：90x90px，清晰易扫
- ✅ **自动日期**：可选自动生成当前日期和时间段
- ✅ **简化配置**：移除手动二维码配置，自动生成
- ✅ **响应式设计**：前后台完美适配手机/平板 🆕

## ✨ 主要功能

### 前台展示 (`index.html`)
- 📊 实时菜品人气排行榜
- 👨‍🍳 厨师日榜 & 月榜
- 👍👎 菜品投票功能（支持防抖优化）
- 📱 响应式设计，支持大屏展示
- 📲 **真实二维码**：扫码跳转到手机端投票和论坛

### 手机端投票 (`mobile-vote.html`) 🆕
- 📱 专为手机优化的投票界面
- 🍽️ 菜品投票（点赞/踩）+ **每日3票限制** 🆕
- 👨‍🍳 厨师投票功能 + **每日3票限制** 🆕
- 🎯 智能投票管理：可投同一项或分散投票
- ✅ 已投项目标记和剩余票数显示
- 🎨 精美的渐变设计

### 心声墙论坛 (`mobile-forum.html`) 🆕
- 💬 **匿名发帖**：无需登录，自由表达
- ❤️ 点赞互动功能
- 📊 实时统计（帖子数、点赞数）
- 🎯 字数限制（5-500字）
- ⏰ 相对时间显示

### 后台管理 (`admin.html`) 🆕 全新界面
- 🔐 **访问控制**：简单密钥验证（默认：`demo2024`）
- 📊 **表格管理**：直接在表格中编辑数据
- ✏️ **即时保存**：失焦自动保存，无需手动点击
- 🖼️ **图片上传**：点击照片即可更换（5MB限制）
- 📥 **批量导入/导出**：支持 CSV 和 JSON 格式
- 📅 **自动日期**：可选自动生成当前日期和时间段
- 🗄️ **SQLite 存储**：更快的查询速度和数据完整性

## 🚀 快速开始

### 安装依赖
```bash
npm install
```

### 启动服务器
```bash
npm start
```

服务器将在 `http://localhost:3010` 启动。

### 访问地址
- **前台看板**：http://localhost:3010
- **后台管理**：http://localhost:3010/admin.html
- **手机投票**：http://localhost:3010/mobile-vote.html 🆕
- **心声墙**：http://localhost:3010/mobile-forum.html 🆕

## 🔑 后台访问

首次访问后台时会提示输入管理密钥：
- 默认密钥：`demo2024`
- 可通过环境变量 `ADMIN_TOKEN` 自定义
- 密钥保存在浏览器 localStorage 中

```bash
# 自定义密钥启动
ADMIN_TOKEN=your_secret_key npm start
```

## 📁 项目结构

```
canting-demo/
├── index.html          # 前台看板页面
├── admin.html          # 后台管理页面 🆕 全新表格界面
├── mobile-vote.html    # 手机端投票页面
├── mobile-forum.html   # 心声墙论坛页面
├── server.js           # Express 服务器 🆕 使用数据库
├── db.js               # 数据库模块 🆕
├── restaurant.db       # SQLite 数据库 🆕
├── static/             # 静态资源（图片）
├── UPGRADE-V3.md       # 升级指南 🆕
└── package.json        # 依赖配置
```

## 🛡️ 安全特性

1. **文件上传限制**
   - 仅允许图片格式（JPEG, PNG, GIF, WEBP）
   - 文件大小限制 5MB
   - 自动生成唯一文件名

2. **访问控制**
   - 后台管理需要密钥验证
   - 上传和保存操作需要认证
   - 前台投票功能公开访问

3. **数据验证**
   - 前后端双重验证
   - 输入参数验证
   - 数据格式检查

## 💡 改进亮点

### 服务器端
- ✅ 文件上传安全限制
- ✅ 自动数据备份机制
- ✅ 简单的访问控制
- ✅ 完善的错误处理
- ✅ 操作日志输出

### 前端
- ✅ 删除操作二次确认
- ✅ 友好的状态提示
- ✅ 图片上传验证
- ✅ 投票防抖优化
- ✅ 键盘快捷键支持
- ✅ 月榜勋章自动分配

## 📝 使用说明

### 添加菜品
1. 进入后台管理页面
2. 在"菜品列表"区域点击"+ 新增一道菜"
3. 填写菜名、厨师、初始点赞数
4. 点击"保存所有修改"

### 上传图片
1. 点击"更换图片..."按钮
2. 选择图片文件（≤5MB）
3. 等待上传完成
4. 点击"保存所有修改"

### 恢复备份
1. 点击底部"📦 备份管理"按钮
2. 查看备份列表
3. 输入序号选择要恢复的备份
4. 确认恢复操作

### 使用二维码功能 🆕
1. 在前台看板页面，右下角显示两个二维码
2. **扫码投票**：用手机扫描后可为菜品投票
3. **心声墙**：用手机扫描后可匿名发帖吐槽
4. 二维码会自动显示当前服务器地址

### 手机端投票 🆕
- 扫码或直接访问 `/mobile-vote.html`
- 切换"菜品投票"和"厨师投票"标签
- 点击 👍 或 👎 为菜品投票
- 投票实时同步到大屏

### 心声墙使用 🆕
- 扫码或直接访问 `/mobile-forum.html`
- 点击右下角 ✍️ 按钮发帖
- 输入内容（5-500字）
- 点击帖子的 ❤️ 进行点赞
- 所有操作匿名，无需登录

## 🔧 环境变量

| 变量名 | 默认值 | 说明 |
|--------|--------|------|
| `ADMIN_TOKEN` | `demo2024` | 后台管理访问密钥 |
| `PORT` | `3010` | 服务器端口（需修改代码） |

## 📦 依赖包

- `express` ^5.2.1 - Web 服务器框架
- `multer` ^2.0.2 - 文件上传中间件
- `qrcode` ^1.5.4 - 二维码生成库
- `better-sqlite3` ^12.5.0 - SQLite 数据库 🆕

## 🐛 故障排除

**问题：无法访问后台管理**
- 确保服务器正在运行
- 检查是否通过 `http://localhost:3010/admin.html` 访问（不要直接打开文件）
- 确认输入的密钥正确

**问题：图片上传失败**
- 检查文件大小是否超过 5MB
- 确认文件格式是否为图片
- 查看控制台错误信息

**问题：保存数据失败**
- 检查文件系统权限
- 确认 data.json 文件可写
- 查看服务器日志

## 📄 许可证

MIT License